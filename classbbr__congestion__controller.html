<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>WinUDPShardedEcho: bbr_congestion_controller Class Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">WinUDPShardedEcho<span id="projectnumber">&#160;main</span>
   </div>
   <div id="projectbrief">A reference implementation of a highly scalable Windows UDP echo server using Winsock + IOCP with SIO_CPU_AFFINITY and one worker thread per CPU to align NIC RSS</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.8 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('classbbr__congestion__controller.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div class="header">
  <div class="summary">
<a href="#pub-methods">Public Member Functions</a> &#124;
<a href="classbbr__congestion__controller-members.html">List of all members</a>  </div>
  <div class="headertitle"><div class="title">bbr_congestion_controller Class Reference</div></div>
</div><!--header-->
<div class="contents">

<p>Lightweight, header-only BBR-like congestion controller.  
 <a href="classbbr__congestion__controller.html#details">More...</a></p>

<p><code>#include &lt;<a class="el" href="bbr_8hpp_source.html">bbr.hpp</a>&gt;</code></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="pub-methods" name="pub-methods"></a>
Public Member Functions</h2></td></tr>
<tr class="memitem:aefb7730dffdce56d26f47f1d8f99d300" id="r_aefb7730dffdce56d26f47f1d8f99d300"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classbbr__congestion__controller.html#aefb7730dffdce56d26f47f1d8f99d300">bbr_congestion_controller</a> ()=default</td></tr>
<tr class="memdesc:aefb7730dffdce56d26f47f1d8f99d300"><td class="mdescLeft">&#160;</td><td class="mdescRight">Default-construct a controller with default parameters.  <br /></td></tr>
<tr class="separator:aefb7730dffdce56d26f47f1d8f99d300"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0dbd259d85d66133990d2fd42e105177" id="r_a0dbd259d85d66133990d2fd42e105177"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classbbr__congestion__controller.html#a0dbd259d85d66133990d2fd42e105177">set_initial_rate</a> (double pps)</td></tr>
<tr class="memdesc:a0dbd259d85d66133990d2fd42e105177"><td class="mdescLeft">&#160;</td><td class="mdescRight">Set an initial upper-bound rate for the controller.  <br /></td></tr>
<tr class="separator:a0dbd259d85d66133990d2fd42e105177"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5a559db1aa65dec1c00d3a566986e08b" id="r_a5a559db1aa65dec1c00d3a566986e08b"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classbbr__congestion__controller.html#a5a559db1aa65dec1c00d3a566986e08b">on_send</a> (uint64_t now_ns, uint64_t seq)</td></tr>
<tr class="memdesc:a5a559db1aa65dec1c00d3a566986e08b"><td class="mdescLeft">&#160;</td><td class="mdescRight">Notify the controller that a packet was sent.  <br /></td></tr>
<tr class="separator:a5a559db1aa65dec1c00d3a566986e08b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2a0e8b588512568fec2fbf900ffdd59b" id="r_a2a0e8b588512568fec2fbf900ffdd59b"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classbbr__congestion__controller.html#a2a0e8b588512568fec2fbf900ffdd59b">on_ack</a> (uint64_t now_ns, uint64_t seq, uint64_t rtt_ns)</td></tr>
<tr class="memdesc:a2a0e8b588512568fec2fbf900ffdd59b"><td class="mdescLeft">&#160;</td><td class="mdescRight">Handle an incoming ACK and update bandwidth / RTT estimates.  <br /></td></tr>
<tr class="separator:a2a0e8b588512568fec2fbf900ffdd59b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:afdde39a3615334c00d1ed188ea0096f3" id="r_afdde39a3615334c00d1ed188ea0096f3"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classbbr__congestion__controller.html#afdde39a3615334c00d1ed188ea0096f3">on_poll</a> (uint64_t now_ns)</td></tr>
<tr class="memdesc:afdde39a3615334c00d1ed188ea0096f3"><td class="mdescLeft">&#160;</td><td class="mdescRight">Periodic poll hook called by the pacer/driver.  <br /></td></tr>
<tr class="separator:afdde39a3615334c00d1ed188ea0096f3"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9fe8302a30607b668e955c5f510fc24a" id="r_a9fe8302a30607b668e955c5f510fc24a"><td class="memItemLeft" align="right" valign="top">double&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classbbr__congestion__controller.html#a9fe8302a30607b668e955c5f510fc24a">target_rate_pps</a> () const</td></tr>
<tr class="memdesc:a9fe8302a30607b668e955c5f510fc24a"><td class="mdescLeft">&#160;</td><td class="mdescRight">Get the current target sending rate in packets-per-second.  <br /></td></tr>
<tr class="separator:a9fe8302a30607b668e955c5f510fc24a"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>Lightweight, header-only BBR-like congestion controller. </p>
<p>This class provides a simplified BBR-inspired rate estimator intended for use by the client pacer. It maintains a short history of sent sequence numbers and ACK timestamps to estimate delivered bandwidth (packets per second) and a smoothed RTT estimate. The controller exposes a target sending rate in packets-per-second which callers should respect when scheduling sends. </p>
</div><h2 class="groupheader">Constructor &amp; Destructor Documentation</h2>
<a id="aefb7730dffdce56d26f47f1d8f99d300" name="aefb7730dffdce56d26f47f1d8f99d300"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aefb7730dffdce56d26f47f1d8f99d300">&#9670;&#160;</a></span>bbr_congestion_controller()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">bbr_congestion_controller::bbr_congestion_controller </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">default</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Default-construct a controller with default parameters. </p>
<p>The controller starts with a conservative target rate (1000 pps by default in the atomic <code>target_rate_</code>). Call <code>set_initial_rate</code> to constrain the controller to a target ceiling derived from the caller's configured rate. </p>

</div>
</div>
<h2 class="groupheader">Member Function Documentation</h2>
<a id="a2a0e8b588512568fec2fbf900ffdd59b" name="a2a0e8b588512568fec2fbf900ffdd59b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a2a0e8b588512568fec2fbf900ffdd59b">&#9670;&#160;</a></span>on_ack()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void bbr_congestion_controller::on_ack </td>
          <td>(</td>
          <td class="paramtype">uint64_t&#160;</td>
          <td class="paramname"><em>now_ns</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint64_t&#160;</td>
          <td class="paramname"><em>seq</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint64_t&#160;</td>
          <td class="paramname"><em>rtt_ns</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Handle an incoming ACK and update bandwidth / RTT estimates. </p>
<p>Updates a smoothed RTT estimate, appends the ACK timestamp into a sliding window used to compute delivered packets-per-second, and computes a new target sending rate. The target is smoothed and never exceeds the value set by <code>set_initial_rate</code>.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">now_ns</td><td>Current time in nanoseconds (ACK receive time). </td></tr>
    <tr><td class="paramname">seq</td><td>Sequence number acknowledged by this ACK. </td></tr>
    <tr><td class="paramname">rtt_ns</td><td>Measured RTT for the acknowledged packet, in nanoseconds. </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="afdde39a3615334c00d1ed188ea0096f3" name="afdde39a3615334c00d1ed188ea0096f3"></a>
<h2 class="memtitle"><span class="permalink"><a href="#afdde39a3615334c00d1ed188ea0096f3">&#9670;&#160;</a></span>on_poll()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void bbr_congestion_controller::on_poll </td>
          <td>(</td>
          <td class="paramtype">uint64_t&#160;</td>
          <td class="paramname"><em>now_ns</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Periodic poll hook called by the pacer/driver. </p>
<p>This allows the controller to apply time-based decay to its bandwidth estimate when no recent ACKs have been seen. Callers should call this with a regularly advancing time value (nanoseconds) from their main loop.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">now_ns</td><td>Current time in nanoseconds. </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="a5a559db1aa65dec1c00d3a566986e08b" name="a5a559db1aa65dec1c00d3a566986e08b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a5a559db1aa65dec1c00d3a566986e08b">&#9670;&#160;</a></span>on_send()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void bbr_congestion_controller::on_send </td>
          <td>(</td>
          <td class="paramtype">uint64_t&#160;</td>
          <td class="paramname"><em>now_ns</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint64_t&#160;</td>
          <td class="paramname"><em>seq</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Notify the controller that a packet was sent. </p>
<p>The controller records the sequence number and send timestamp so that delivered rate can later be estimated when ACKs arrive. Implementations should call this for each transmitted packet that they expect to be ACKed.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">now_ns</td><td>Current time in nanoseconds. </td></tr>
    <tr><td class="paramname">seq</td><td>Packet sequence number associated with the send. </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="a0dbd259d85d66133990d2fd42e105177" name="a0dbd259d85d66133990d2fd42e105177"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a0dbd259d85d66133990d2fd42e105177">&#9670;&#160;</a></span>set_initial_rate()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void bbr_congestion_controller::set_initial_rate </td>
          <td>(</td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>pps</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Set an initial upper-bound rate for the controller. </p>
<p>This method records the externally requested initial rate (in packets-per-second) and updates the internal target and bandwidth estimates to match that value. The controller will not increase its computed target above this initial value.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">pps</td><td>Initial packets-per-second rate to use as an upper bound. </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="a9fe8302a30607b668e955c5f510fc24a" name="a9fe8302a30607b668e955c5f510fc24a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a9fe8302a30607b668e955c5f510fc24a">&#9670;&#160;</a></span>target_rate_pps()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">double bbr_congestion_controller::target_rate_pps </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td> const</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Get the current target sending rate in packets-per-second. </p>
<p>This returns the controller's smoothed target rate which callers should respect when scheduling packet transmissions.</p>
<dl class="section return"><dt>Returns</dt><dd>Target packets-per-second. </dd></dl>

</div>
</div>
<hr/>The documentation for this class was generated from the following file:<ul>
<li>src/common/<a class="el" href="bbr_8hpp_source.html">bbr.hpp</a></li>
</ul>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="classbbr__congestion__controller.html">bbr_congestion_controller</a></li>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.8 </li>
  </ul>
</div>
</body>
</html>
